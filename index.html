<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>What if Eye...?</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.cdnfonts.com/css/linux-biolinum" rel="stylesheet">
    <link rel="icon" href="images/eye-favicon.png" type="image/png">

    <!-- This code snippet is used to set up Google Tag Manager (GTM) on the webpage. 
         It loads the GTM script asynchronously and initializes the data layer. 
         The gtag function is then used to configure GTM with the tracking ID 'G-RZKKHXXYQM'. 
         This is needed to enable tracking and analytics on the website, allowing the site owner to collect data on user behavior and interactions. -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-RZKKHXXYQM"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-RZKKHXXYQM');
    </script>
    <!-- End of Google Tag Manager setup -->
</head>
<body>
   <button class="theme-toggle" id="theme-toggle" type="button" aria-pressed="false">
       <span class="toggle-icon" id="theme-toggle-icon" aria-hidden="true">ðŸŒ™</span>
       <span class="toggle-label" id="theme-toggle-label">Dark mode</span>
   </button>
   <section class="hero">
       <video class="hero-video" autoplay loop muted playsinline>
           <source src="videos/eye-evolution-hero.mp4" type="video/mp4" playbackRate="100">
       </video>
       <div class="hero-overlay"></div>
       <div class="hero-content" style="text-align: center; bottom: -30%; transform: translateY(-50%);">
           <h1><i>What if Eye</i>...?</h1>
           <p>We created a virtual petri dish where digital creatures evolve eyes from scratch, replaying millions of years of evolution.</p>
           <div class="chevron">&#x25BC;</div>
       </div>
   </section>

   <section class="evolution-tree" id="evolution-tree">
       <div class="content tree-header">
           <div class="tree-kicker">Evolution Tree</div>
           <h2>Visual intelligence unfurls as you scroll</h2>
           <p class="tree-lede">Follow the lineage from light-sensitive dots to lenses, simulators, and museum-grade exhibits. The trunk carries the core evolutionary path while branches surface papers, tools, and experiences.</p>
           <div class="scroll-cue">
               <span>Scroll to grow the tree</span>
               <div class="scroll-line"></div>
           </div>
       </div>
       <div class="tree-wrapper" id="tree-wrapper">
           <svg class="tree-svg" id="tree-svg" aria-hidden="true"></svg>
           <div class="nodes-layer" id="tree-nodes"></div>
       </div>
   </section>

   <section class="partners">
       <div class="content">
           <h3>Supported by</h3>
           <div class="partner-logos">
               <div class="institution">
                   <img src="images/mas.webp" alt="MIT Media Lab, Camera Culture">
               </div>
               <div class="institution">
                   <img src="images/cbmm.png" alt="Center for Brains Minds and Machines, MIT">
               </div>
               <div class="institution">
                   <img src="images/csail.png" alt="InfoLab, MIT CSAIL">
               </div>
               <div class="institution">
                   <img src="images/lund.svg" alt="Lund Vision Group">
               </div>
               <div class="institution">
                   <img src="images/rice.png" alt="Rice University">
               </div>
           </div>
       </div>
   </section>

   <footer style="text-align: center;">
       <div class="content" style="display: inline-block;">
           <p>Copyright 2025 MIT Media Lab. All rights reserved.</p>
           <div class="links">
               <a href="mailto:ktiwary@mit.edu,aryoung@mit.edu">Contact</a>
               <a href="https://github.com/cambrian-org/ACI">GitHub</a>
               <a href="#">Twitter</a>
           </div>
           <a href="https://accessibility.mit.edu" class="accessibility">MIT Accessibility</a>
       </div>
   </footer>

   <script>
    const themeToggle = document.getElementById('theme-toggle');
    const themeToggleLabel = document.getElementById('theme-toggle-label');
    const themeToggleIcon = document.getElementById('theme-toggle-icon');

    function setTheme(theme) {
        document.body.setAttribute('data-theme', theme);
        localStorage.setItem('theme', theme);
        if (themeToggleLabel) {
            themeToggleLabel.textContent = theme === 'light' ? 'Light mode' : 'Dark mode';
        }
        if (themeToggleIcon) {
            themeToggleIcon.textContent = theme === 'light' ? 'â˜€ï¸' : 'ðŸŒ™';
        }
        if (themeToggle) {
            themeToggle.setAttribute('aria-pressed', theme === 'light');
        }
    }

    const savedTheme = localStorage.getItem('theme');
    const prefersLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
    setTheme(savedTheme || (prefersLight ? 'light' : 'dark'));

    themeToggle?.addEventListener('click', () => {
        const nextTheme = document.body.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
        setTheme(nextTheme);
    });

    const treeNodes = [
        {
            id: 'proto-root',
            parentId: null,
            order: 0,
            title: 'Bacterial Phototaxis (Gen 0)',
            subtitle: 'Light-shy swimmers reacting to gradients before eyes even exist.',
            tags: ['Seed'],
            media: { type: 'video', src: 'videos/navigation_evolved_agent_initial.mp4', poster: 'images/eye.png' },
            links: [],
            layout: { side: 'center', xOffset: 0, yOffset: -20 }
        },
        {
            id: 'root-spark-left',
            parentId: 'proto-root',
            order: 0,
            title: 'Dormant microbe',
            variant: 'dot',
            links: [],
            layout: { side: 'left', xOffset: -240, yOffset: -90 }
        },
        {
            id: 'root-spark-right',
            parentId: 'proto-root',
            order: 0,
            title: 'Lost colony',
            variant: 'dot',
            links: [],
            layout: { side: 'right', xOffset: 240, yOffset: -70 }
        },
        {
            id: 'orientation',
            parentId: 'proto-root',
            order: 1,
            title: 'Orientation & Navigation',
            subtitle: 'Primitive photoreceptors learning to follow light gradients and avoid darkness.',
            tags: ['Task'],
            media: { type: 'video', src: 'videos/navigation.mp4', poster: 'images/eye.png' },
            links: [],
            layout: { side: 'left', xOffset: -180, yOffset: 0 }
        },
        {
            id: 'orientation-detour',
            parentId: 'orientation',
            order: 1,
            title: 'Blinded offshoot',
            variant: 'dot',
            links: [],
            layout: { side: 'right', xOffset: 320, yOffset: -40 }
        },
        {
            id: 'food-poison',
            parentId: 'orientation',
            order: 2,
            title: 'Food & Poison Discrimination',
            subtitle: 'Camera-like sensing emerges as creatures weigh nourishment versus danger.',
            tags: ['Task'],
            media: { type: 'video', src: 'videos/detection.mp4', poster: 'images/eye.png' },
            links: [],
            layout: { side: 'right', xOffset: 170, yOffset: 0 }
        },
        {
            id: 'food-detour',
            parentId: 'food-poison',
            order: 2,
            title: 'Toxic cul-de-sac',
            variant: 'dot',
            links: [],
            layout: { side: 'left', xOffset: -320, yOffset: -30 }
        },
        {
            id: 'prey-tracking',
            parentId: 'food-poison',
            order: 3,
            title: 'Prey Tracking',
            subtitle: 'Predictive gaze and motion-aware retinas for chasing agile targets.',
            tags: ['Task'],
            media: { type: 'video', src: 'videos/tracking.mp4', poster: 'images/eye.png' },
            links: [],
            layout: { side: 'left', xOffset: -120, yOffset: 10 }
        },
        {
            id: 'tracking-detour',
            parentId: 'prey-tracking',
            order: 3,
            title: 'Trail fizzles',
            variant: 'dot',
            links: [],
            layout: { side: 'right', xOffset: 320, yOffset: 40 }
        },
        {
            id: 'emergence',
            parentId: 'prey-tracking',
            order: 4,
            title: 'Emergence from light-sensitive photoreceptors',
            subtitle: 'Compound-like eyes versus camera-like eyes appear from survival pressures.',
            tags: ['Milestone'],
            media: { type: 'video', src: 'videos/Evolution-of-Compound-Type-Eyes.mp4', poster: 'images/eye.png' },
            links: [],
            layout: { side: 'center', xOffset: 0, yOffset: 20 }
        },
        {
            id: 'emergence-detour-left',
            parentId: 'emergence',
            order: 4,
            title: 'Vestigial pigment cup',
            variant: 'dot',
            links: [],
            layout: { side: 'left', xOffset: -280, yOffset: 30 }
        },
        {
            id: 'generations',
            parentId: 'emergence',
            order: 5,
            title: 'Generational improvement (Gen 0 â†’ Gen 50)',
            subtitle: '50 generations sharpen behaviors, contrast, and reaction time.',
            tags: ['Evolution'],
            media: { type: 'video', src: 'videos/navigation_evolved_agent_final.mp4', poster: 'images/eye.png' },
            links: [],
            layout: { side: 'right', xOffset: 210, yOffset: -10 }
        },
        {
            id: 'lenses',
            parentId: 'generations',
            order: 6,
            title: 'Why do eyes have lenses?',
            subtitle: 'Adaptive optics focus scarce photons, balancing blur and brightness.',
            tags: ['Optics'],
            media: { type: 'video', src: 'videos/mask_aperture_sweep.mp4', poster: 'images/eye.png' },
            links: [],
            layout: { side: 'left', xOffset: -180, yOffset: 0 }
        },
        {
            id: 'mutations',
            parentId: 'lenses',
            order: 7,
            title: 'Optical gene mutations â†’ lens / PSF effects',
            subtitle: 'Random apertures create sharp, distorted, and kaleidoscopic visual fields.',
            tags: ['Optical Gene'],
            media: { type: 'video', src: 'videos/optics_agent.mp4', poster: 'images/eye.png' },
            links: [],
            layout: { side: 'right', xOffset: 180, yOffset: 10 }
        },
        {
            id: 'mutation-detour',
            parentId: 'mutations',
            order: 7,
            title: 'Lens bubble',
            variant: 'dot',
            links: [],
            layout: { side: 'left', xOffset: -340, yOffset: -10 }
        },
        {
            id: 'paper',
            parentId: 'mutations',
            order: 8,
            title: 'What if Eye...? Computationally Recreating Vision Evolution',
            subtitle: 'Paper + talk on replaying the Cambrian explosion in silico.',
            tags: ['Publication'],
            media: { type: 'video', src: 'videos/Evolution-of-Camera-Type-Eyes.mp4', poster: 'images/eye.png' },
            links: [
                { label: 'Paper (arXiv)', href: 'https://arxiv.org/abs/2501.15001' },
                { label: 'Blog', href: '/what-if/' },
                { label: 'TEDx Talk', href: 'https://www.youtube.com/watch?v=OuPwGkzh6nM' }
            ],
            layout: { side: 'center', xOffset: 0, yOffset: 20 }
        },
        {
            id: 'aci',
            parentId: 'paper',
            order: 9,
            title: 'Artificial Cambrian Intelligence',
            subtitle: 'Evolve your own creatures: define tasks, simulate, and watch eyes emerge.',
            tags: ['Toolkit'],
            media: { type: 'video', src: 'videos/navigation_evolved_agent_final.mp4', poster: 'images/eye.png' },
            links: [
                { label: 'Documentation', href: 'https://eyes.mit.edu/ACI' },
                { label: 'Examples', href: 'https://eyes.mit.edu/ACI/examples/index.html' }
            ],
            layout: { side: 'left', xOffset: -220, yOffset: 0 }
        },
        {
            id: 'roadmap',
            parentId: 'paper',
            order: 9,
            title: 'A Roadmap for Generative Design of Visual Intelligence',
            subtitle: 'Biological principles point to a Cambrian explosion of artificial vision.',
            tags: ['Impact'],
            media: { type: 'video', src: 'videos/circular_aperture_sweep_realistic.mp4', poster: 'images/eye.png' },
            links: [
                { label: 'MIT Press Impact Paper', href: 'https://mit-genai.pubpub.org/pub/bcfcb6lu/release/3' }
            ],
            layout: { side: 'right', xOffset: 220, yOffset: 0 }
        },
        {
            id: 'exhibits',
            parentId: 'mutations',
            order: 8,
            title: 'Exhibits: Experience the First Signs of Vision in VR',
            subtitle: 'Museum experiences that let visitors step inside evolving eyesight.',
            tags: ['Exhibit'],
            media: { type: 'video', src: 'videos/Evolution-of-Compound-Type-Eyes.mp4', poster: 'images/eye.png' },
            links: [
                { label: 'MIT Museum', href: 'https://eyes.mit.edu/' },
                { label: 'Museum of Science', href: 'https://eyes.mit.edu/' },
                { label: 'More Details', href: 'https://eyes.mit.edu/' }
            ],
            layout: { side: 'right', xOffset: 280, yOffset: 80 }
        }
    ];


    const nodesLayer = document.getElementById('tree-nodes');
    const treeWrapper = document.getElementById('tree-wrapper');
    const treeSvg = document.getElementById('tree-svg');
    const nodeMap = new Map();
    const pathMap = new Map();
    const spacingBase = 260;
    const startY = 140;

    function createNodeCard(node) {
        if (node.variant === 'dot') {
            const dot = document.createElement('div');
            dot.className = 'tree-node branch-dot upcoming';
            dot.dataset.id = node.id;
            dot.dataset.parent = node.parentId || '';
            dot.dataset.variant = 'dot';
            dot.setAttribute('aria-label', node.title || 'Decorative branch');
            dot.innerHTML = `<span class="branch-dot-core"></span>`;
            nodesLayer.appendChild(dot);
            nodeMap.set(node.id, dot);
            return;
        }

        const card = document.createElement('article');
        card.className = 'tree-node upcoming';
        card.dataset.id = node.id;
        card.dataset.parent = node.parentId || '';
        card.dataset.variant = 'card';

        const tagMarkup = (node.tags || []).map(tag => `<span class="node-tag">${tag}</span>`).join('');
        const linksMarkup = (node.links || []).map(link => `<a class="node-cta" href="${link.href}" target="_blank" rel="noopener">${link.label}</a>`).join('');

        let mediaMarkup = '';
        if (node.media?.type === 'video') {
            mediaMarkup = `
                <video autoplay muted loop playsinline poster="${node.media.poster || ''}">
                    <source src="${node.media.src}" type="video/mp4">
                </video>
            `;
        } else if (node.media?.type === 'image') {
            mediaMarkup = `<img src="${node.media.src}" alt="${node.title} visual">`;
        }

        card.innerHTML = `
            <div class="node-media">${mediaMarkup}</div>
            <div class="node-body">
                <div class="node-meta">
                    <div class="node-tags">${tagMarkup}</div>
                    <div class="node-branch"></div>
                </div>
                <h3>${node.title}</h3>
                <p>${node.subtitle || ''}</p>
                <div class="node-ctas">${linksMarkup}</div>
            </div>
        `;

        nodesLayer.appendChild(card);
        nodeMap.set(node.id, card);
    }

    function renderNodes() {
        nodesLayer.innerHTML = '';
        nodeMap.clear();
        treeNodes
            .slice()
            .sort((a, b) => a.order - b.order)
            .forEach(createNodeCard);
    }

    function computePosition(node, index) {
        const width = treeWrapper.clientWidth;
        const isMobile = window.innerWidth < 900;
        const baseX = width / 2;
        const side = node.layout?.side || (index % 2 === 0 ? 'left' : 'right');
        const branchOffset = isMobile ? 90 : 180;
        const customOffset = node.layout?.xOffset || 0;
        const offsetXRaw = customOffset + (side === 'left' ? -branchOffset : side === 'right' ? branchOffset : 0);
        const offsetX = isMobile ? offsetXRaw * 0.45 : offsetXRaw;
        const offsetY = node.layout?.yOffset || 0;
        const y = startY + (node.order * (isMobile ? spacingBase * 0.82 : spacingBase)) + offsetY;
        const x = baseX + offsetX;
        return { x, y };
    }

    function positionNodes() {
        const orderedNodes = treeNodes.slice().sort((a, b) => a.order - b.order);
        let maxY = 0;
        orderedNodes.forEach((node, index) => {
            const card = nodeMap.get(node.id);
            if (!card) return;
            const pos = computePosition(node, index);
            card.style.left = `${pos.x}px`;
            card.style.top = `${pos.y}px`;
            maxY = Math.max(maxY, pos.y);
        });
        treeWrapper.style.height = `${maxY + 420}px`;
        drawPaths();
    }

    function ensurePaths() {
        treeSvg.innerHTML = '';
        pathMap.clear();
        treeNodes.forEach(node => {
            if (!node.parentId) return;
            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            path.setAttribute('class', 'tree-path-segment');
            path.dataset.child = node.id;
            treeSvg.appendChild(path);
            pathMap.set(node.id, path);
        });
    }

    function drawPaths() {
        const wrapperRect = treeWrapper.getBoundingClientRect();
        treeSvg.setAttribute('width', wrapperRect.width);
        treeSvg.setAttribute('height', treeWrapper.scrollHeight);

        treeNodes.forEach(node => {
            if (!node.parentId) return;
            const child = nodeMap.get(node.id);
            const parent = nodeMap.get(node.parentId);
            const path = pathMap.get(node.id);
            if (!child || !parent || !path) return;

            const childRect = child.getBoundingClientRect();
            const parentRect = parent.getBoundingClientRect();
            const startX = parentRect.left - wrapperRect.left + (parentRect.width / 2);
            const startY = parentRect.top - wrapperRect.top + (parentRect.height / 2);
            const endX = childRect.left - wrapperRect.left + (childRect.width / 2);
            const endY = childRect.top - wrapperRect.top + (childRect.height / 2);
            const controlY = (startY + endY) / 2;
            const d = `M ${startX} ${startY} C ${startX} ${controlY}, ${endX} ${controlY}, ${endX} ${endY}`;
            path.setAttribute('d', d);
        });
    }

    function setActiveNode(activeId) {
        const orderedNodes = treeNodes.slice().sort((a, b) => a.order - b.order);
        const storyline = orderedNodes.filter(node => node.variant !== 'dot');
        const activeIndex = storyline.findIndex(n => n.id === activeId);
        const visitedIds = new Set(storyline.slice(0, activeIndex).map(n => n.id));

        orderedNodes.forEach(node => {
            const card = nodeMap.get(node.id);
            if (!card) return;
            card.classList.remove('active', 'visited', 'upcoming', 'decorative-node');
            if (node.variant === 'dot') {
                card.classList.add('decorative-node');
                return;
            }
            if (visitedIds.has(node.id)) {
                card.classList.add('visited');
            } else if (node.id === activeId) {
                card.classList.add('active');
            } else {
                card.classList.add('upcoming');
            }
        });

        pathMap.forEach((path, childId) => {
            const node = treeNodes.find(n => n.id === childId);
            if (!path || !node) return;
            const targetCard = nodeMap.get(childId);
            const parentVisited = node.parentId ? visitedIds.has(node.parentId) || node.parentId === activeId : false;

            if (node.variant === 'dot') {
                if (parentVisited) {
                    path.classList.add('path-revealed');
                } else {
                    path.classList.remove('path-revealed');
                }
                return;
            }

            if (targetCard && (targetCard.classList.contains('active') || targetCard.classList.contains('visited'))) {
                path.classList.add('path-revealed');
            } else {
                path.classList.remove('path-revealed');
            }
        });
    }

    function setupObserver() {
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    setActiveNode(entry.target.dataset.id);
                }
            });
        }, {
            root: null,
            threshold: 0.35,
            rootMargin: '-30% 0px -30% 0px'
        });

        treeNodes
            .filter(node => node.variant !== 'dot')
            .forEach(node => {
                const card = nodeMap.get(node.id);
                if (card) observer.observe(card);
            });
    }

    function initTree() {
        renderNodes();
        ensurePaths();
        positionNodes();
        const storyline = treeNodes.filter(node => node.variant !== 'dot').sort((a, b) => a.order - b.order);
        if (storyline.length) {
            setActiveNode(storyline[0].id);
        }
        setupObserver();
    }

    if (typeof ResizeObserver !== 'undefined') {
        const resizeObserver = new ResizeObserver(() => {
            positionNodes();
        });
        resizeObserver.observe(treeWrapper);
    }
    window.addEventListener('resize', positionNodes);

    window.addEventListener('load', initTree);
   </script>
</body>
</html>
